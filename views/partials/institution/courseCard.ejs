<div class="container mt-4 mb-4">
  <div class="d-flex" style="margin-left: 1.5rem;">
    <div class="dropdown">
      <button class="btn btn-light border rounded-pill px-4 py-2 fw-medium shadow-sm d-flex align-items-center gap-2"
              type="button" data-bs-toggle="dropdown" aria-expanded="false"
              style="font-size: 15px;">
        <i class="bi bi-arrow-down-up"></i>
        Sort by
      </button>
      <ul class="dropdown-menu rounded-4 shadow-sm">
        <li><a class="dropdown-item sort-option" data-sort="title">ğŸ“˜ Title (A-Z)</a></li>
        <li><a class="dropdown-item sort-option" data-sort="date">ğŸ“… Last Updated</a></li>
        <li><a class="dropdown-item sort-option" data-sort="students">ğŸ‘¥ Student Count</a></li>
        <li><a class="dropdown-item sort-option" data-sort="rating">â­ Rating</a></li>
      </ul>
    </div>
  </div>
</div>

<div class="container px-4">
  <div class="list-group">
    <% courses.forEach(course => { %>
      <div class="list-group-item bg-white border-0 rounded-4 shadow-sm mb-4 px-4 py-4">
        <div class="d-flex flex-wrap align-items-center justify-content-between">
          <div class="d-flex align-items-center gap-3">
            <div style="width: 60px; height: 60px; background: #e9ecef; border-radius: 12px;"></div>
            <div>
              <strong class="fs-5"><%= course.name %></strong>
              <div class="small text-muted mt-1">
                By <%= course.instructor %> â€¢ Updated: <%= course.dateCreated %><br>
                â­ <%= course.rating %> Reviews &nbsp;|&nbsp; ğŸ‘¥ <%= course.studentsEnrolled?.length || 0 %> Students
              </div>
            </div>
          </div>
          <div class="d-flex gap-2 mt-3 mt-md-0">
            <a href="/institution/editCourse/<%= course._id %>?returnTo=/institution/manageCourses" class="btn btn-outline-danger btn-sm">Edit</a>
            <form action="/institution/deleteInstitutionCourses/<%= course._id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this course?')">
              <button class="btn btn-sm btn-outline-danger">Delete</button>
            </form>
            <a href="/institution/viewCourse/<%= course._id %>" class="btn btn-sm btn-outline-secondary">View</a>
          </div>
        </div>
      </div>
    <% }) %>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const courseList = document.querySelector(".list-group");

    const getValue = (card, key) => {
      if (key === "title") return card.querySelector("strong")?.textContent.trim().toLowerCase();
      if (key === "date") {
        const match = card.querySelector(".text-muted")?.textContent.match(/\d{4}\/\d{2}\/\d{2}/);
        return new Date(match ? match[0] : null);
      }
      if (key === "students") return parseInt(card.innerText.match(/ğŸ‘¥\s*(\d+)/)?.[1]) || 0;
      if (key === "rating") return parseFloat(card.innerText.match(/â­\s*(\d+(\.\d+)?)/)?.[1]) || 0;
      return "";
    };

    const sortCards = (key) => {
      const cards = Array.from(courseList.querySelectorAll(".list-group-item"));
      cards.sort((a, b) => {
        const valA = getValue(a, key);
        const valB = getValue(b, key);
        return typeof valA === "string" ? valA.localeCompare(valB) : valB - valA;
      });
      courseList.innerHTML = "";
      cards.forEach(card => courseList.appendChild(card));
    };

    document.querySelectorAll(".sort-option").forEach(item => {
      item.addEventListener("click", () => {
        const sortKey = item.dataset.sort;
        sortCards(sortKey);
      });
    });

    // const removeButtons = document.querySelectorAll(".btn-remove-course");


      button.addEventListener("click", async () => {
        const courseId = button.dataset.id;
        // if (!confirm("Are you sure you want to delete this course?")) return;

        try {
          const res = await fetch(`/institution/deleteInstitutionCourses/${courseId}`, {
            method: "POST",
            headers: { "Content-Type": "application/json" }
          });
        } catch (err) {
          console.error("Delete error:", err);
          alert("An error occurred while deleting.");
        }
      });

  });
</script>