<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Courses</title>

    <!-- Bootstrap 5 CSS CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Bootstrap Icons CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/navBarStyle.css" />
    <style>
      .course-card {
        border-radius: 12px;
        overflow: hidden;
        transition: transform 0.3s, box-shadow 0.3s;
        margin-bottom: 20px;
        border: 1px solid #e0e0e0;
      }

      .course-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      }

      .course-image {
        width: 200px;
        height: 150px;
        object-fit: cover;
      }

      .course-content {
        padding: 15px;
      }

      .course-title {
        font-weight: 600;
        margin-bottom: 5px;
      }

      .progress-indicator {
        display: inline-block;
        padding: 5px 15px;
        border-radius: 20px;
        font-weight: 600;
        color: white;
        background-color: #ee6c4d;
      }

      .progress-low {
        background-color: #f8d7da;
        color: #842029;
      }

      .progress-medium {
        background-color: #fff3cd;
        color: #664d03;
      }

      .progress-high {
        background-color: #d1e7dd;
        color: #0f5132;
      }

      .learn-now-btn {
        background-color: #ee6c4d;
        color: white;
        border: none;
        border-radius: 20px;
        padding: 5px 15px;
        transition: background-color 0.3s;
      }

      .learn-now-btn:hover {
        background-color: #e95d3c;
        color: white;
      }

      .filter-btn {
        border-radius: 20px;
        margin: 0 5px;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        color: #6c757d;
        font-size: 0.9rem;
        padding: 5px 15px;
        transition: all 0.2s;
      }

      .filter-btn:hover {
        background-color: #e9ecef;
        color: #495057;
      }

      .filter-btn.active {
        background-color: #ee6c4d;
        border-color: #ee6c4d;
        color: white;
      }

      .enrolled-header {
        font-weight: 700;
        text-align: center;
        margin: 30px 0;
        font-size: 2rem;
      }

      .filters-container {
        display: flex;
        justify-content: center;
        margin-bottom: 30px;
      }

      .course-details {
        color: #6c757d;
        font-size: 0.9rem;
      }

      .course-instructor {
        font-size: 0.9rem;
        color: #495057;
        margin-bottom: 5px;
      }

      .dropdown-menu {
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        border: none;
        border-radius: 0.5rem;
      }

      .dropdown-item:hover {
        background-color: #f8f9fa;
      }

      .dropdown-item.active {
        background-color: #ee6c4d;
      }

      .search-box {
        position: relative;
        max-width: 300px;
        margin: 0 auto 1.5rem auto;
      }

      .search-box .form-control {
        padding-left: 2.5rem;
        border-radius: 20px;
      }

      .search-icon {
        position: absolute;
        left: 1rem;
        top: 0.6rem;
        color: #6c757d;
      }
    </style>
  </head>
  <body>
    <!--Include Nav Bar-->
    <%- include('partials/navbar') %>

    
    <div class="container my-5">
      <h1 class="enrolled-header">YOUR ENROLLED COURSES</h1>
    
      <!-- Search Box -->
      <div class="search-box mb-4">
        <i class="bi bi-search search-icon"></i>
        <input
          type="text"
          id="courseSearch"
          class="form-control"
          placeholder="Search your courses"
        />
      </div>
    
      <!-- Filter Buttons -->
      <div class="filters-container">
        <div class="dropdown me-2">
          <button
            class="btn filter-btn dropdown-toggle"
            type="button"
            id="sortDropdown"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <i class="bi bi-sort-down me-1"></i> Sort By
          </button>
          <ul class="dropdown-menu" aria-labelledby="sortDropdown">
            <li>
              <a class="dropdown-item active" href="#" data-sort="recent">
                Recently Enrolled
              </a>
            </li>
            <li>
              <a class="dropdown-item" href="#" data-sort="oldest">
                Oldest First
              </a>
            </li>
            <li>
              <a class="dropdown-item" href="#" data-sort="name">Course Name</a>
            </li>

          </ul>
        </div>
    
        <button class="btn filter-btn active" data-filter="all">
          All Courses
        </button>
      </div>
    
      <!-- Enrolled Courses List -->
      <div class="enrolled-courses" id="enrolledCoursesList">
        <% if (enrolledCourses && enrolledCourses.length > 0) { %>
          <% enrolledCourses.forEach(course => { %>
            <!-- Course Card -->
            <div
              class="course-card"
              data-name="<%= course.title ? course.title.toLowerCase() : '' %>"
              data-category="<%= course.category ? course.category.toLowerCase() : '' %>"
              data-progress="<%= course.progress %>"
              data-progress-status="<%= course.progress === 100 ? 'completed' : course.progress > 0 ? 'in-progress' : 'not-started' %>"
            >
              <div class="row g-0">
                <div class="col-md-3">
                  <img
                    src="<%= course.image || 'images/course-placeholder.jpg' %>"
                    class="course-image"
                    alt="<%= course.title || 'Course' %>"
                  />
                </div>
                <div class="col-md-7">
                  <div class="course-content">
                    <h5 class="course-title"><%= course.name || 'Untitled Course' %></h5>
                    <p class="course-instructor">
                      Created by: <%= course.author ? `${course.author.firstName} ${course.author.lastName}` : 'Unknown Author' %>
                    </p>
                    <p class="course-description">
                      <%= course.description ? course.description.substring(0, 100) : '' %><%=
                        course.description && course.description.length > 100 ? '...' : '' %>
                    </p>
                    <div class="course-details">
                      <div class="mb-2">
                        <i class="bi bi-clock me-2"></i><%= course.duration || '350 hours' %>
                      </div>
                    </div>
    
           
                  </div>
                </div>
                <div class="col-md-2 d-flex flex-column justify-content-center align-items-center">
                  <a
                    href="/courses/<%= course._id %>/learn"
                    class="btn learn-now-btn mt-3"
                    >Learn Now</a
                  >
                </div>
              </div>
            </div>
          <% }); %>
        <% } else { %>
          <!-- No enrolled courses message -->
          <div class="text-center py-5" id="noCourses">
            <i class="bi bi-journal-bookmark display-1 text-muted"></i>
            <h3 class="mt-4">You haven't enrolled in any courses yet</h3>
            <p class="text-muted">
              Explore our catalog and find courses that match your interests
            </p>
            <a href="/courses" class="btn btn-lg learn-now-btn mt-3">Browse Courses</a>
          </div>
        <% } %>
      </div>
    </div>
    



    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Course filtering and sorting script -->
    <!-- Course filtering and sorting script -->
    <script>
 document.addEventListener("DOMContentLoaded", function () {
  const enrolledCoursesDiv = document.getElementById("enrolledCoursesList");
  const noCoursesDiv = document.getElementById("noCourses");
  
  // Get all course cards
  const courseCards = document.querySelectorAll(".course-card");
  
  // Sort dropdown functionality
  const sortOptions = document.querySelectorAll(".dropdown-item[data-sort]");
  sortOptions.forEach((option) => {
    option.addEventListener("click", (e) => {
      e.preventDefault();

      // Remove active class from all sort options
      sortOptions.forEach((opt) => opt.classList.remove("active"));
      // Add active class to clicked option
      option.classList.add("active");

      // Update dropdown button text
      document.getElementById("sortDropdown").innerHTML = `<i class="bi bi-sort-down me-1"></i> ${option.textContent}`;

      const sortValue = option.getAttribute("data-sort");
      const cardsArray = Array.from(courseCards);

      // Sort cards based on selected option
      switch (sortValue) {
        case "recent":
          // Use current display order as fallback if no enrollment date
          // You should add actual enrollment dates in your EJS template
          cardsArray.sort((a, b) => {
            // Default to current order if no date present
            return 0;
          });
          break;
        case "oldest":
          // Same as above but reversed
          cardsArray.sort((a, b) => {
            // Default to current order if no date present
            return 0;
          });
          break;
        case "name":
          cardsArray.sort((a, b) => {
            const nameA = (a.querySelector(".course-title")?.textContent || "").toLowerCase();
            const nameB = (b.querySelector(".course-title")?.textContent || "").toLowerCase();
            return nameA.localeCompare(nameB);
          });
          break;
      }

      // Re-append cards in the new order
      cardsArray.forEach((card) => {
        enrolledCoursesDiv.appendChild(card);
      });
    });
  });

  // Filter functionality
  const filterButtons = document.querySelectorAll(".filter-btn[data-filter]");
  filterButtons.forEach((button) => {
    button.addEventListener("click", () => {
      // Remove active class from all filter buttons
      filterButtons.forEach((btn) => btn.classList.remove("active"));
      // Add active class to clicked button
      button.classList.add("active");

      const filterValue = button.getAttribute("data-filter");
      
      // Show all courses if "all" is selected
      if (filterValue === "all") {
        courseCards.forEach((card) => {
          card.style.display = "";
        });
        return;
      }
      
      // Otherwise filter by progress status or other criteria
      courseCards.forEach((card) => {
        if (card.getAttribute("data-category") === filterValue || 
            card.getAttribute("data-progress-status") === filterValue) {
          card.style.display = "";
        } else {
          card.style.display = "none";
        }
      });
    });
  });

  // Search functionality
  const searchInput = document.getElementById("courseSearch");
  if (searchInput) {
    searchInput.addEventListener("input", () => {
      const searchTerm = searchInput.value.toLowerCase().trim();

      courseCards.forEach((card) => {
        // Get text content from elements that definitely exist rather than attributes
        const title = card.querySelector(".course-title")?.textContent.toLowerCase() || "";
        const description = card.querySelector(".course-description")?.textContent.toLowerCase() || "";
        const instructor = card.querySelector(".course-instructor")?.textContent.toLowerCase() || "";

        // Check if course matches search term
        if (
          title.includes(searchTerm) ||
          description.includes(searchTerm) ||
          instructor.includes(searchTerm)
        ) {
          card.style.display = "";
        } else {
          card.style.display = "none";
        }
      });
    });
  }
});
    </script>
    

  </body>
</html>
