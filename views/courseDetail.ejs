<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= course.title %> - LearnNow</title>
  
  <!-- Bootstrap 5 CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Bootstrap Icons CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/navBarStyle.css">
  <link rel="stylesheet" href="/css/darkMode.css">
  
  <style>
    /* Flying cart icon animation */
    .flying-cart {
      position: fixed;
      font-size: 1.5rem;
      color: #ee6c4d;
      pointer-events: none;
      z-index: 1000;
      transition: all 0.8s cubic-bezier(0.18, 0.89, 0.32, 1.28);
      opacity: 0;
    }

    /* Button animation */
    .btn-animation {
      animation: btnPulse 1.2s ease-in-out;
    }

    @keyframes btnPulse {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
      100% {
        transform: scale(1);
      }
    }

    /* Cart counter styling and animation */
    .cart-counter {
      display: flex;
      align-items: center;
      justify-content: center;
      position: absolute;
      top: -8px;
      right: -8px;
      background-color: #ee6c4d;
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 12px;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    
    /* Dedicated pulse animation for cart counter */
    .pulse-animation {
      animation: counterPulse 0.6s ease-in-out;
    }
    
    @keyframes counterPulse {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.5);
      }
      100% {
        transform: scale(1);
      }
    }

    .course-header {
      background-color: #f8f9fa;
      padding: 60px 0;
      position: relative;
    }
    
    .course-title {
      font-weight: 700;
      font-size: 2.5rem;
      margin-bottom: 15px;
      color: #333;
    }
    
    .course-instructor {
      font-size: 1.1rem;
      color: #6c757d;
      margin-bottom: 20px;
    }
    
    .course-stats {
      display: flex;
      gap: 30px;
      margin-bottom: 30px;
    }
    
    .stat-item {
      display: flex;
      align-items: center;
    }
    
    .stat-icon {
      color: #ee6c4d;
      font-size: 1.2rem;
      margin-right: 8px;
    }
    
    .course-image {
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      height: 100%;
      min-height: 300px;
      object-fit: cover;
    }
    
    .enroll-card {
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      padding: 30px;
      position: sticky;
      top: 100px;
    }
    
    .course-price {
      font-size: 2.5rem;
      font-weight: 700;
      color: #333;
      margin-bottom: 20px;
    }
    
    .course-price.free {
      color: #28a745;
    }
    
    .enroll-btn {
      background-color: #ee6c4d;
      border: none;
      color: white;
      padding: 12px 30px;
      font-weight: 600;
      font-size: 1.1rem;
      border-radius: 30px;
      width: 100%;
      margin-bottom: 15px;
      transition: all 0.3s;
    }
    
    .enroll-btn:hover {
      background-color: #e95d3c;
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(238, 108, 77, 0.3);
    }
    
    .cart-btn {
      background-color: white;
      border: 2px solid #ee6c4d;
      color: #ee6c4d;
      padding: 12px 30px;
      font-weight: 600;
      font-size: 1.1rem;
      border-radius: 30px;
      width: 100%;
      margin-bottom: 20px;
      transition: all 0.3s;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      position: relative;
      overflow: hidden;
      height: 52px; 
      padding: 12px 30px; /* same padding as enroll*/
      box-sizing: border-box; 
    }
    
    .cart-btn:hover {
      background-color: #fff8f6;
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(238, 108, 77, 0.15);
      color: #e95d3c;
    }
    
    .cart-btn .cart-icon {
      font-size: 1.2rem;
    }
    
    .btn-container {
      position: relative;
    }
    
    .course-includes {
      margin-bottom: 20px;
    }
    
    .includes-item {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .includes-icon {
      color: #28a745;
      margin-right: 10px;
    }
    
    .category-badge {
      display: inline-block;
      background-color: #ee6c4d;
      color: white;
      padding: 6px 15px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 20px;
    }
    
    .course-sections {
      margin-top: 60px;
    }
    
    .section-title {
      font-weight: 600;
      font-size: 1.8rem;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 1px solid #dee2e6;
    }
    
    .course-description {
      line-height: 1.8;
      font-size: 1.1rem;
      color: #6c757d;
    }
    
    .instructor-section {
      background-color: #f8f9fa;
      padding: 50px 0;
      margin-top: 60px;
    }
    
    .instructor-img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 20px;
    }
    
    .instructor-name {
      font-weight: 600;
      font-size: 1.3rem;
      margin-bottom: 10px;
    }
    
    .instructor-bio {
      font-size: 1rem;
      color: #6c757d;
      line-height: 1.7;
    }
    
    /* Toast notification */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1100;
    }
    
    .custom-toast {
      background-color: #fff;
      border-left: 4px solid #28a745;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      border-radius: 4px;
      padding: 15px 25px 15px 15px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      max-width: 350px;
      animation: slideIn 0.3s ease-out forwards;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .toast-icon {
      color: #28a745;
      font-size: 1.5rem;
    }
    
    .toast-message {
      font-weight: 500;
      color: #333;
    }
    
    .toast-close {
      position: absolute;
      top: 8px;
      right: 8px;
      color: #999;
      cursor: pointer;
      font-size: 0.9rem;
    }
    
    /* Dark mode overrides */
    body.dark-mode .course-header {
      background-color: #1a1a1a;
    }
    
    body.dark-mode .enroll-card {
      background-color: #1e1e1e;
    }
    
    body.dark-mode .instructor-section {
      background-color: #1a1a1a;
    }
    
    body.dark-mode .course-title,
    body.dark-mode .course-price {
      color: #e0e0e0;
    }
    
    body.dark-mode .cart-btn {
      background-color: #1e1e1e;
      border-color: #ee6c4d;
      color: #ee6c4d;
    }
    
    body.dark-mode .cart-btn:hover {
      background-color: #2a2a2a;
    }
    
    body.dark-mode .custom-toast {
      background-color: #1e1e1e;
      color: #e0e0e0;
    }
    
    body.dark-mode .toast-message {
      color: #e0e0e0;
    }
    
    /* Responsive adjustments */
    @media (max-width: 992px) {
      .enroll-card {
        position: static;
        margin-top: 30px;
      }
      
      .course-image {
        margin-bottom: 30px;
      }
    }
  </style>
</head>
<body>
  <!-- Include Navigation -->
  <%- include('partials/navbar') %>
  
  <!-- Toast Container for Notifications -->
  <div class="toast-container"></div>
  
  <!-- Course Header -->
  <section class="course-header">
    <div class="container">
      <div class="row">
        <div class="col-lg-8">
          <span class="category-badge"><%= course.category || 'General' %></span>
          <h1 class="course-title"><%= course.title %></h1>
          <p class="course-instructor">Created by <%= course.instructor || 'Unknown Instructor' %></p>
          
          <div class="course-stats">
            <div class="stat-item">
              <i class="bi bi-clock stat-icon"></i>
              <span><%= course.duration || 'Duration not specified' %></span>
            </div>
            <div class="stat-item">
              <i class="bi bi-star-fill stat-icon"></i>
              <span><%= course.rating || '0' %> (<%= Math.floor(Math.random() * 1000) %> reviews)</span>
            </div>
            <div class="stat-item">
              <i class="bi bi-calendar-check stat-icon"></i>
              <span>Last updated <%= new Date(course.updatedAt || course.createdAt).toLocaleDateString('en-US', { month: 'long', year: 'numeric' }) %></span>
            </div>
          </div>
          
          <img src="<%= course.imageUrl || course.imageURL || '/images/course-placeholder.jpg' %>" alt="<%= course.title %>" class="course-image d-block d-lg-none">
        </div>
        
        <div class="col-lg-4">
          <div class="enroll-card">
            <% if (course.price) { %>
              <div class="course-price <%= course.price === 0 ? 'free' : '' %>">
                <%= course.price === 0 ? 'Free' : '$' + course.price %>
              </div>
            <% } else { %>
              <div class="course-price">$49.99</div>
            <% } %>
            
            <div class="btn-container">
              <button class="btn enroll-btn">Enroll Now</button>
              <button class="btn cart-btn" data-id="<%= course._id %>">
                <i class="bi bi-cart-plus cart-icon"></i>
                Add to Cart
              </button>              
            </div>
            
            <div class="course-includes">
              <h5>This course includes:</h5>
              <div class="includes-item">
                <i class="bi bi-play-circle includes-icon"></i>
                <span><%= Math.floor(Math.random() * 20) + 10 %> hours on-demand video</span>
              </div>
              <div class="includes-item">
                <i class="bi bi-file-earmark-text includes-icon"></i>
                <span><%= Math.floor(Math.random() * 15) + 5 %> downloadable resources</span>
              </div>
              <div class="includes-item">
                <i class="bi bi-infinity includes-icon"></i>
                <span>Full lifetime access</span>
              </div>
              <div class="includes-item">
                <i class="bi bi-award includes-icon"></i>
                <span>Certificate of completion</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- Course Content -->
  <section class="course-sections">
    <div class="container">
      <div class="row">
        <div class="col-lg-8">
          <!-- About This Course -->
          <div class="mb-5">
            <h2 class="section-title">About This Course</h2>
            <div class="course-description">
              <% if (course.description) { %>
                <p><%= course.description %></p>
              <% } else { %>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce euismod, nisl eget tincidunt ultricies, nunc elit ultricies nunc, vitae luctus nisl nunc eget nunc. Donec euismod, nisl eget tincidunt ultricies, nunc elit ultricies nunc, vitae luctus nisl nunc eget nunc.</p>
                <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.</p>
              <% } %>
            </div>
          </div>
          
          <!-- What You'll Learn -->
          <div class="mb-5">
            <h2 class="section-title">What You'll Learn</h2>
            <div class="row">
              <div class="col-md-6">
                <ul class="list-unstyled">
                  <li class="mb-3"><i class="bi bi-check2-circle text-success me-2"></i> Master the fundamentals of <%= course.category || 'this subject' %></li>
                  <li class="mb-3"><i class="bi bi-check2-circle text-success me-2"></i> Build real-world projects for your portfolio</li>
                  <li class="mb-3"><i class="bi bi-check2-circle text-success me-2"></i> Understand advanced concepts and techniques</li>
                </ul>
              </div>
              <div class="col-md-6">
                <ul class="list-unstyled">
                  <li class="mb-3"><i class="bi bi-check2-circle text-success me-2"></i> Follow industry best practices</li>
                  <li class="mb-3"><i class="bi bi-check2-circle text-success me-2"></i> Solve common problems efficiently</li>
                  <li class="mb-3"><i class="bi bi-check2-circle text-success me-2"></i> Prepare for real-world applications</li>
                </ul>
              </div>
            </div>
          </div>
          
          <!-- Course Content Preview -->
          <div class="mb-5">
            <h2 class="section-title">Course Content</h2>
            <div class="accordion" id="courseContentAccordion">
              <!-- Section 1 -->
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingOne">
                  <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    Section 1: Introduction
                  </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#courseContentAccordion">
                  <div class="accordion-body">
                    <ul class="list-group list-group-flush">
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                          <i class="bi bi-play-circle me-2"></i>
                          Welcome to the Course
                        </div>
                        <span class="text-muted">10:15</span>
                      </li>
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                          <i class="bi bi-play-circle me-2"></i>
                          Course Overview
                        </div>
                        <span class="text-muted">15:22</span>
                      </li>
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                          <i class="bi bi-file-earmark-text me-2"></i>
                          Getting Started Guide
                        </div>
                        <span class="text-muted">PDF</span>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
              
              <!-- Section 2 -->
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingTwo">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                    Section 2: Fundamentals
                  </button>
                </h2>
                <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#courseContentAccordion">
                  <div class="accordion-body">
                    <ul class="list-group list-group-flush">
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                          <i class="bi bi-play-circle me-2"></i>
                          Core Concepts
                        </div>
                        <span class="text-muted">22:45</span>
                      </li>
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                          <i class="bi bi-play-circle me-2"></i>
                          Essential Tools
                        </div>
                        <span class="text-muted">18:30</span>
                      </li>
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                          <i class="bi bi-play-circle me-2"></i>
                          Best Practices
                        </div>
                        <span class="text-muted">25:12</span>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
              
              <!-- Section 3 -->
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingThree">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                    Section 3: Advanced Topics
                  </button>
                </h2>
                <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#courseContentAccordion">
                  <div class="accordion-body">
                    <ul class="list-group list-group-flush">
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                          <i class="bi bi-lock-fill me-2 text-muted"></i>
                          Advanced Techniques
                        </div>
                        <span class="badge bg-warning text-dark">Preview</span>
                      </li>
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                          <i class="bi bi-lock-fill me-2 text-muted"></i>
                          Real-world Applications
                        </div>
                        <span class="text-muted">45:10</span>
                      </li>
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                          <i class="bi bi-lock-fill me-2 text-muted"></i>
                          Final Project
                        </div>
                        <span class="text-muted">1:15:00</span>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- Instructor Section -->
  <section class="instructor-section">
    <div class="container">
      <div class="row">
        <div class="col-lg-8">
          <h2 class="section-title">Your Instructor</h2>
          <div class="row">
            <div class="col-md-3 text-center">
              <img src="/images/instructor-placeholder.jpg" alt="<%= course.instructor || 'Instructor' %>" class="instructor-img">
              <h4 class="instructor-name"><%= course.instructor || 'Instructor Name' %></h4>
            </div>
            <div class="col-md-9">
              <p class="instructor-bio">
                <%= course.instructorBio || 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce euismod, nisl eget tincidunt ultricies, nunc elit ultricies nunc, vitae luctus nisl nunc eget nunc. Donec euismod, nisl eget tincidunt ultricies, nunc elit ultricies nunc, vitae luctus nisl nunc eget nunc.' %>
              </p>
              <div class="instructor-stats mt-4">
                <div class="row">
                  <div class="col-6 col-md-4">
                    <div class="stat-item">
                      <i class="bi bi-star-fill stat-icon"></i>
                      <span>4.7 Instructor Rating</span>
                    </div>
                  </div>
                  <div class="col-6 col-md-4">
                    <div class="stat-item">
                      <i class="bi bi-chat-fill stat-icon"></i>
                      <span>2,450 Reviews</span>
                    </div>
                  </div>
                  <div class="col-6 col-md-4">
                    <div class="stat-item">
                      <i class="bi bi-people-fill stat-icon"></i>
                      <span>12,500 Students</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- Include Footer -->
  <%- include('partials/footer') %>
  
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Dark Mode JS -->
  <script src="/js/darkMode.js"></script>
  
  <!-- Subscription form handler -->
  <script src="/js/footer.js"></script>
  
  <!-- Course enrollment and cart script -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const enrollButton = document.querySelector('.enroll-btn');
    const cartButton = document.querySelector('.cart-btn');
    
    // Find the navbar cart icon for animation target
    const navbarCartIcon = document.querySelector('.navbar .bi-cart') || 
                           document.querySelector('.navbar .bi-cart-fill') ||
                           document.querySelector('.navbar [class*="cart"]');
    
    if (enrollButton) {
      enrollButton.addEventListener('click', function() {
        // You would handle the enrollment here
        alert('Enrollment functionality coming soon!');
      });
    }
    
    if (cartButton) {
      cartButton.addEventListener('click', function() {
        const courseId = cartButton.dataset.id;
        
        // Create flying cart icon
        const flyingCart = document.createElement('div');
        flyingCart.className = 'flying-cart';
        flyingCart.innerHTML = '<i class="bi bi-cart-plus"></i>';
        document.body.appendChild(flyingCart);
        
        // Set initial position (where the button is)
        const buttonRect = cartButton.getBoundingClientRect();
        flyingCart.style.top = `${buttonRect.top + buttonRect.height/2 - 10}px`;
        flyingCart.style.left = `${buttonRect.left + buttonRect.width/2 - 10}px`;
        
        // Make it visible
        setTimeout(() => {
          flyingCart.style.opacity = '1';
        }, 10);
        
        // Set target position (where the navbar cart icon is)
        let targetX, targetY;
        
        if (navbarCartIcon) {
          const targetRect = navbarCartIcon.getBoundingClientRect();
          targetX = targetRect.left + targetRect.width/2 - 10;
          targetY = targetRect.top + targetRect.height/2 - 10;
        } else {
          // If no cart icon found, fly to top right corner
          targetX = window.innerWidth - 50;
          targetY = 20;
        }
        
        // Start animation
        setTimeout(() => {
          flyingCart.style.transform = 'scale(0.5)';
          flyingCart.style.top = `${targetY}px`;
          flyingCart.style.left = `${targetX}px`;
          flyingCart.style.opacity = '0';
        }, 50);
        
        // Add button animation
        cartButton.classList.add('btn-animation');
        setTimeout(() => {
          cartButton.classList.remove('btn-animation');
        }, 1200);
        
        // Clean up
        setTimeout(() => {
          document.body.removeChild(flyingCart);
          
          // Update cart counter
          updateCartCounter();
        }, 800);
        
        // Send request to add to cart
        fetch(`/cart/add/${courseId}`, {
          method: 'POST'
        })
        .then(res => res.json())
        .then(data => {
          if (!data.success) {
            console.error('Failed to add course to cart');
          }
        })
        .catch(err => {
          console.error('Error adding course to cart:', err);
        });
      });
    }
    
    // Function to update cart counter
    function updateCartCounter() {
      const cartCounter = document.querySelector('.cart-counter');
      if (cartCounter) {
        // Get current count and increment
        let count = parseInt(cartCounter.textContent || '0');
        cartCounter.textContent = count + 1;
        
        // Make sure it's visible
        cartCounter.style.display = 'flex';
        
        // Remove existing animation class if present
        cartCounter.classList.remove('pulse-animation');
        
        // Force reflow to restart animation
        void cartCounter.offsetWidth;
        
        // Add animation class
        cartCounter.classList.add('pulse-animation');
        
        // Remove class when animation is done
        setTimeout(() => {
          cartCounter.classList.remove('pulse-animation');
        }, 600);
      } else {
        // If the cart counter doesn't exist yet, we need to create it
        const navCartIcon = document.querySelector('.navbar .bi-cart') || 
                            document.querySelector('.navbar .bi-cart-fill') ||
                            document.querySelector('.navbar [class*="cart"]');
        
        if (navCartIcon) {
          // Find the parent element to properly position the counter
          const iconContainer = navCartIcon.parentElement;
          if (iconContainer) {
            // Make sure the container has position relative for absolute positioning
            if (window.getComputedStyle(iconContainer).position === 'static') {
              iconContainer.style.position = 'relative';
            }
            
            // Create the counter element
            const counter = document.createElement('span');
            counter.className = 'cart-counter';
            counter.textContent = '1';
            iconContainer.appendChild(counter);
            
            // Add animation
            setTimeout(() => {
              counter.classList.add('pulse-animation');
              
              // Remove class when animation is done
              setTimeout(() => {
                counter.classList.remove('pulse-animation');
              }, 600);
            }, 10);
          }
        }
      }
    }
  });
</script>
</body>
</html>